<!DOCTYPE html>
<html>
<head>
    <title>Teste Mercado Pago</title>
    <script src="https://sdk.mercadopago.com/js/v2"></script>
</head>
<body>
    <h1>Teste de Pagamento - Mercado Pago</h1>
    
    <form id="form-checkout">
        <input type="text" id="cardNumber" placeholder="N√∫mero do cart√£o" value="4509953566233704">
        <input type="text" id="expirationDate" placeholder="MM/YY" value="11/25">
        <input type="text" id="securityCode" placeholder="CVV" value="123">
        <input type="text" id="cardHolderName" placeholder="Nome no cart√£o" value="APRO">
        <input type="number" id="valor" placeholder="Valor" value="1">
        <button type="submit">Pagar</button>
    </form>

    <div id="result"></div>

    <script>
        const mp = new MercadoPago('TEST-f2683a59-b033-4162-893a-c163028ff1eb');
        
        document.getElementById('form-checkout').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = 'Processando...';
            
            try {
                console.log('üéØ Criando token...');
                
                // Criar token
                const cardToken = await mp.createCardToken({
                    cardNumber: document.getElementById('cardNumber').value.replace(/\s/g, ''),
                    expirationMonth: '11',
                    expirationYear: '2025',
                    securityCode: document.getElementById('securityCode').value,
                    cardHolderName: document.getElementById('cardHolderName').value,
                });

                console.log('‚úÖ Token criado:', cardToken);

                if (cardToken.error) {
                    throw new Error('Erro ao criar token: ' + cardToken.error.message);
                }

                // Enviar para API de teste
                const response = await fetch('/api/test-payment', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        cardToken: cardToken.id,
                        valor: parseFloat(document.getElementById('valor').value)
                    })
                });

                const result = await response.json();
                
                console.log('üìã Resultado da API:', result);
                
                if (result.success) {
                    resultDiv.innerHTML = `
                        <h3 style="color: green;">‚úÖ Sucesso!</h3>
                        <p>Payment ID: ${result.payment_id}</p>
                        <p>Status: ${result.status}</p>
                    `;
                } else {
                    resultDiv.innerHTML = `
                        <h3 style="color: red;">‚ùå Erro</h3>
                        <p>${result.error}</p>
                        <pre>${JSON.stringify(result, null, 2)}</pre>
                    `;
                }

            } catch (error) {
                console.error('‚ùå Erro:', error);
                resultDiv.innerHTML = `
                    <h3 style="color: red;">‚ùå Erro</h3>
                    <p>${error.message}</p>
                `;
            }
        });
    </script>
</body>
</html>
